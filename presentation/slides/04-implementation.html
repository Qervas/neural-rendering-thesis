<section class="section-slide">
  <span class="section-number">4</span>
  <h2>Implementation</h2>
</section>

<section>
  <h2>1. Connect Cameras</h2>
  <img src="assets/images/connect.png" alt="Connect" style="max-height: 70vh; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
  <p style="margin-top: 0.5em; color: #666;">Discover and connect to all 12 GigE cameras</p>
</section>

<section>
  <h2>2. Configure Settings</h2>
  <img src="assets/images/setup.png" alt="Setup" style="max-height: 70vh; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
  <p style="margin-top: 0.5em; color: #666;">Set exposure, rotation steps, output folder</p>
</section>

<section>
  <h2>3. Capture Sequence</h2>
  <img src="assets/images/capture.png" alt="Capture" style="max-height: 70vh; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
  <p style="margin-top: 0.5em; color: #666;">Automated: capture → rotate → repeat</p>
</section>

<section>
  <h2>Settings Dialog</h2>
  <img src="assets/images/settings.png" alt="Settings" style="max-height: 70vh; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
  <p style="margin-top: 0.5em; color: #666;">Camera parameters, turntable speed, output format</p>
</section>

<section>
  <h2>Debug Console</h2>
  <img src="assets/images/console.png" alt="Console" style="max-height: 70vh; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
  <p style="margin-top: 0.5em; color: #666;">Real-time logging for troubleshooting</p>
</section>

<section>
  <h2>How It Works</h2>
  <img src="assets/images/architecture_diagram.svg" alt="Software Architecture" style="max-height: 75vh; width: auto;">
</section>

<!-- Parallel Processing -->
<section>
  <h2>Parallel Processing</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <img src="assets/images/parallel_save_diagram.svg" alt="Parallel Processing" style="max-height: 75vh; width: auto;">
  </div>
</section>

<!-- RealityCapture Workflow -->
<section>
  <h2>RealityCapture Workflow</h2>
  <div style="display: flex; justify-content: center; align-items: center; height: 70vh;">
    <svg viewBox="0 0 650 180" style="width: 95%; max-width: 1200px;">
      <!-- Arrow marker definition -->
      <defs>
        <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
        </marker>
      </defs>

      <!-- Step boxes -->
      <rect x="10" y="60" width="110" height="80" rx="8" fill="#e7f5ff" stroke="#00a3e0" stroke-width="2"/>
      <text x="65" y="95" text-anchor="middle" font-size="11" font-weight="bold" fill="#00a3e0">Import</text>
      <text x="65" y="112" text-anchor="middle" font-size="9" fill="#666">Images</text>

      <rect x="140" y="60" width="110" height="80" rx="8" fill="#e7f5ff" stroke="#00a3e0" stroke-width="2"/>
      <text x="195" y="90" text-anchor="middle" font-size="11" font-weight="bold" fill="#00a3e0">Align</text>
      <text x="195" y="107" text-anchor="middle" font-size="9" fill="#666">+ Control Points</text>
      <text x="195" y="122" text-anchor="middle" font-size="9" fill="#666">if needed</text>

      <rect x="270" y="60" width="110" height="80" rx="8" fill="#e7f5ff" stroke="#00a3e0" stroke-width="2"/>
      <text x="325" y="95" text-anchor="middle" font-size="11" font-weight="bold" fill="#00a3e0">High Detail</text>
      <text x="325" y="112" text-anchor="middle" font-size="9" fill="#666">Mesh</text>

      <rect x="400" y="60" width="110" height="80" rx="8" fill="#e7f5ff" stroke="#00a3e0" stroke-width="2"/>
      <text x="455" y="95" text-anchor="middle" font-size="11" font-weight="bold" fill="#00a3e0">Texture</text>
      <text x="455" y="112" text-anchor="middle" font-size="9" fill="#666">UV mapping</text>

      <rect x="530" y="60" width="110" height="80" rx="8" fill="#00a3e0" stroke="#00a3e0" stroke-width="2"/>
      <text x="585" y="95" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">Export</text>
      <text x="585" y="112" text-anchor="middle" font-size="9" fill="#fff">Mesh + Transforms</text>

      <!-- Arrows -->
      <path d="M120,100 L140,100" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
      <path d="M250,100 L270,100" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
      <path d="M380,100 L400,100" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
      <path d="M510,100 L530,100" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

      <!-- Bottom note -->
      <text x="325" y="170" text-anchor="middle" font-size="11" fill="#666">Control points fix alignment for difficult objects • ArUco markers for specular surfaces</text>
    </svg>
  </div>
</section>

<!-- Sky Removal for Gränsö -->
<section>
  <h2>Sky Masking for Outdoor Scenes</h2>
  <div class="split-layout" style="align-items: start;">
    <div>
      <p>RealityCapture supports masks to ignore sky pixels</p>
      <ul style="margin-top: 1em; font-size: 0.95em;">
        <li class="fragment"><strong>Problem:</strong> Sky confuses feature matching</li>
        <li class="fragment"><strong>Solution:</strong> Black = ignore, White = reconstruct</li>
        <li class="fragment">First tried: Gemini AI
          <ul style="font-size: 0.85em; color: #666;">
            <li>Dark windows treated as sky ✗</li>
          </ul>
        </li>
        <li class="fragment">Used: <strong>OpenDroneMap/SkyRemoval</strong>
          <ul style="font-size: 0.85em; color: #666;">
            <li>ML model trained for aerial imagery ✓</li>
          </ul>
        </li>
      </ul>
      <p class="fragment" style="margin-top: 1em; font-size: 0.85em; color: #666;">
        Credit: <a href="https://github.com/OpenDroneMap/SkyRemoval" target="_blank" style="color: var(--liu-turquoise);">github.com/OpenDroneMap/SkyRemoval</a>
      </p>
    </div>
    <div class="fragment" style="text-align: center; font-size: 0.9em;">
      <p style="margin-bottom: 0.5em; color: #666;">Comparison coming next...</p>
    </div>
  </div>
</section>

<!-- Sky Removal Comparison -->
<section>
  <h2>Sky Removal: Gemini vs SkyRemoval</h2>
  <div style="display: flex; justify-content: center; gap: 1.5em; align-items: flex-start;">
    <!-- Original photo -->
    <div style="text-align: center; flex: 0 0 30%;">
      <img src="assets/images/_07A0007.jpg" alt="Original" style="max-height: 55vh; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
      <p style="margin-top: 0.5em; color: #666; font-weight: 600;">Original Photo</p>
    </div>
    <!-- Comparison slider -->
    <div style="flex: 0 0 50%; text-align: center;">
      <img-comparison-slider style="width: 100%; --divider-width: 3px; --divider-color: var(--liu-turquoise);">
        <img slot="first" src="assets/images/_07A0007.mask_gemini.jpg" alt="Gemini" style="width: 100%; height: auto; border-radius: 8px;">
        <img slot="second" src="assets/images/_07A0007.mask_skyremoval.png" alt="SkyRemoval" style="width: 100%; height: auto; border-radius: 8px;">
      </img-comparison-slider>
      <div style="display: flex; justify-content: space-between; margin-top: 0.5em;">
        <p style="color: #dc3545; font-weight: 600; margin: 0;">← Gemini (windows = sky ✗)</p>
        <p style="color: var(--liu-turquoise); font-weight: 600; margin: 0;">SkyRemoval ✓ →</p>
      </div>
    </div>
  </div>
</section>

<!-- Nerfstudio Workflow -->
<section>
  <h2>Nerfstudio Workflow</h2>
  <div style="display: flex; justify-content: center; align-items: center; height: 75vh;">
    <svg viewBox="0 0 900 320" style="width: 100%; max-width: 1400px;" font-family="Segoe UI, Arial, sans-serif">
      <defs>
        <marker id="ns-arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
        </marker>
        <filter id="ns-shadow" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="2" dy="3" stdDeviation="4" flood-opacity="0.15"/>
        </filter>
      </defs>

      <!-- COLMAP - Failed approach -->
      <g filter="url(#ns-shadow)">
        <rect x="30" y="70" width="180" height="110" rx="12" fill="#fff3cd" stroke="#ffc107" stroke-width="3"/>
      </g>
      <text x="120" y="105" text-anchor="middle" font-size="18" font-weight="bold" fill="#856404">COLMAP</text>
      <text x="120" y="128" text-anchor="middle" font-size="13" fill="#856404">Default SfM tool</text>
      <text x="120" y="150" text-anchor="middle" font-size="12" fill="#856404">Light inconsistency</text>
      <text x="120" y="172" text-anchor="middle" font-size="13" fill="#dc3545" font-weight="600">85% failure rate ✗</text>

      <!-- X mark between -->
      <text x="240" y="135" font-size="36" fill="#dc3545" font-weight="bold">✗</text>

      <!-- RealityCapture - Solution -->
      <g filter="url(#ns-shadow)">
        <rect x="280" y="80" width="180" height="90" rx="12" fill="#e6fcf5" stroke="#0cc7d3" stroke-width="3"/>
      </g>
      <text x="370" y="115" text-anchor="middle" font-size="18" font-weight="bold" fill="#0cc7d3">RealityCapture</text>
      <text x="370" y="145" text-anchor="middle" font-size="14" fill="#0aa">Commercial SfM</text>
      <text x="370" y="165" text-anchor="middle" font-size="13" fill="#0cc7d3" font-weight="600">Export transforms ✓</text>

      <!-- Arrow down from RC -->
      <path d="M370,175 L370,210" stroke="#333" stroke-width="3" marker-end="url(#ns-arrow)"/>

      <!-- Convert step -->
      <g filter="url(#ns-shadow)">
        <rect x="295" y="220" width="150" height="70" rx="10" fill="#f8f9fa" stroke="#666" stroke-width="2"/>
      </g>
      <text x="370" y="252" text-anchor="middle" font-size="15" font-weight="600" fill="#333">Convert to</text>
      <text x="370" y="275" text-anchor="middle" font-size="14" fill="#666" font-style="italic">transforms.json</text>

      <!-- Arrow right from Convert -->
      <path d="M450,255 L520,255" stroke="#333" stroke-width="3" marker-end="url(#ns-arrow)"/>

      <!-- Training Methods -->
      <g filter="url(#ns-shadow)">
        <rect x="540" y="180" width="160" height="60" rx="10" fill="#e7f5ff" stroke="#00a3e0" stroke-width="3"/>
      </g>
      <text x="620" y="205" text-anchor="middle" font-size="17" font-weight="bold" fill="#00a3e0">Nerfacto</text>
      <text x="620" y="228" text-anchor="middle" font-size="13" fill="#00a3e0">~80 min training</text>

      <g filter="url(#ns-shadow)">
        <rect x="540" y="260" width="160" height="60" rx="10" fill="#e6fcf5" stroke="#0cc7d3" stroke-width="3"/>
      </g>
      <text x="620" y="285" text-anchor="middle" font-size="17" font-weight="bold" fill="#0cc7d3">Splatfacto</text>
      <text x="620" y="308" text-anchor="middle" font-size="13" fill="#0cc7d3">~40 min training</text>

      <!-- Arrows to output -->
      <path d="M700,210 L740,210 L740,255 L770,255" stroke="#00a3e0" stroke-width="2.5"/>
      <path d="M700,290 L740,290 L740,255 L770,255" stroke="#0cc7d3" stroke-width="2.5"/>

      <!-- Output -->
      <g filter="url(#ns-shadow)">
        <rect x="780" y="200" width="100" height="110" rx="12" fill="#333"/>
      </g>
      <text x="830" y="245" text-anchor="middle" font-size="16" font-weight="bold" fill="#fff">Novel</text>
      <text x="830" y="268" text-anchor="middle" font-size="16" font-weight="bold" fill="#fff">Views</text>
      <text x="830" y="295" text-anchor="middle" font-size="11" fill="#aaa">Any angle</text>

      <!-- Title labels -->
      <text x="120" y="55" text-anchor="middle" font-size="13" fill="#999" font-weight="500">Problem</text>
      <text x="370" y="55" text-anchor="middle" font-size="13" fill="#999" font-weight="500">Solution</text>
      <text x="620" y="155" text-anchor="middle" font-size="13" fill="#999" font-weight="500">Training</text>
      <text x="830" y="180" text-anchor="middle" font-size="13" fill="#999" font-weight="500">Output</text>
    </svg>
  </div>
</section>
